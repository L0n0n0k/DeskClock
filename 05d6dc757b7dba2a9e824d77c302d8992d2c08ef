{
  "comments": [
    {
      "key": {
        "uuid": "8cd7a9a8_30f977a0",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1691576
      },
      "writtenOn": "2020-07-27T17:00:09Z",
      "side": 1,
      "message": "Hi Luca,\n\nI\u0027m seeing some test failures here when I run the following to run the DeskClockTests target:\n$ source build/envsetup.sh\n$ lunch aosp_sargo-userdebug\n$ make DeskClockKotlin\n$ adb install out/target/product/sargo/product/app/DeskClockKotlin/DeskClockKotlin.apk\n$ make DeskClockTests\n$ adb install out/target/product/sargo/testcases/DeskClockTests/arm64/DeskClockTests.apk\n$ adb shell am instrument -w com.android.deskclock.tests\n\nIf you could run these tests and fix the errors that would be much appreciated! I\u0027m happy to provide any additional info that might help!",
      "revId": "05d6dc757b7dba2a9e824d77c302d8992d2c08ef",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4fcba191_9606ca5b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1081223
      },
      "writtenOn": "2020-07-27T19:14:28Z",
      "side": 1,
      "message": "Sad!\nI\u0027m currently unable to run tests ( somehow emulator doesn\u0027t fire up :/ ), can you please post the error there?\nI just made sure it built and made sense code wise...\n\nAnyways, you can also do `atest DeskClockTests`",
      "parentUuid": "8cd7a9a8_30f977a0",
      "revId": "05d6dc757b7dba2a9e824d77c302d8992d2c08ef",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7877e11a_da3df8d5",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1691576
      },
      "writtenOn": "2020-07-27T19:37:02Z",
      "side": 1,
      "message": "Sure! The following are the unique errors I\u0027m seeing:\n\n1) java.lang.NoSuchMethodError: No virtual method getTabAt(I)Lcom/android/deskclock/uidata/UiDataModel$Tab; in class Lcom/android/deskclock/uidata/TabModel; or its super classes (declaration of \u0027com.android.deskclock.uidata.TabModel\u0027 appears in /data/app/com.android.deskclock-_PugAUJnDWGJnQOuviYTkA\u003d\u003d/base.apk)\n\tat com.android.deskclock.uidata.TabModelTest.rtlTabLayoutIndex(TabModelTest.java:56)\n\tat java.lang.reflect.Method.invoke(Native Method)\n\tat org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)\n\tat org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)\n\tat org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:52)\n\tat org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)\n\tat org.junit.internal.runners.statements.FailOnTimeout$CallableStatement.call(FailOnTimeout.java:148)\n\tat org.junit.internal.runners.statements.FailOnTimeout$CallableStatement.call(FailOnTimeout.java:142)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:266)\n\tat java.lang.Thread.run(Thread.java:922)\n\n\n2) Caused by: java.lang.NoSuchMethodError: No virtual method selectTab()V in class Lcom/android/deskclock/timer/TimerFragment; or its super classes (declaration of \u0027com.android.deskclock.timer.TimerFragment\u0027 appears in /data/app/com.android.deskclock-_PugAUJnDWGJnQOuviYTkA\u003d\u003d/base.apk)\n\tat com.android.deskclock.timer.TimerSetupViewTest.lambda$setUp$0(TimerSetupViewTest.java:80)\n\tat com.android.deskclock.timer.TimerSetupViewTest.lambda$setUp$0$TimerSetupViewTest(Unknown Source:0)\n\tat com.android.deskclock.timer.-$$Lambda$TimerSetupViewTest$AcLwtnoV4UY6nfHT9uJyOQLvAHk.run(Unknown Source:6)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:462)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:266)\n\tat android.app.Instrumentation$SyncRunnable.run(Instrumentation.java:2214)\n\tat android.os.Handler.handleCallback(Handler.java:934)\n\tat android.os.Handler.dispatchMessage(Handler.java:99)\n\tat android.os.Looper.loop(Looper.java:216)\n\tat android.app.ActivityThread.main(ActivityThread.java:7396)\n\tat java.lang.reflect.Method.invoke(Native Method)\n\tat com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:548)\n\tat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:928)\n\n3) java.lang.RuntimeException: kotlin.UninitializedPropertyAccessException: lateinit property mViewPager has not been initialized\n\tat androidx.test.runner.MonitoringInstrumentation.runOnMainSync(MonitoringInstrumentation.java:450)\n\tat com.android.deskclock.timer.TimerFragmentTest.setUpFragment(TimerFragmentTest.java:129)\n\tat com.android.deskclock.timer.TimerFragmentTest.setUpSingleTimer(TimerFragmentTest.java:94)\n\tat com.android.deskclock.timer.TimerFragmentTest.clickAdd_addsOneMinuteToTimer(TimerFragmentTest.java:389)\n\tat java.lang.reflect.Method.invoke(Native Method)\n\tat org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)\n\tat org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)\n\tat org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:52)\n\tat org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)\n\tat org.junit.internal.runners.statements.FailOnTimeout$CallableStatement.call(FailOnTimeout.java:148)\n\tat org.junit.internal.runners.statements.FailOnTimeout$CallableStatement.call(FailOnTimeout.java:142)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:266)\n\tat java.lang.Thread.run(Thread.java:922)\n\n36 tests failed\n---------------\ncom.android.deskclock.timer.TimerFragmentTest#fabClick_restartsTimer\ncom.android.deskclock.timer.TimerFragmentTest#fabClick_resetsTimer\ncom.android.deskclock.timer.TimerFragmentTest#timeClick_pausesSecondTimer\ncom.android.deskclock.timer.TimerFragmentTest#showTimer_fromIntent\ncom.android.deskclock.timer.TimerFragmentTest#timeClick_startsTimer\ncom.android.deskclock.timer.TimerFragmentTest#timeClick_pausesTimer\ncom.android.deskclock.timer.TimerFragmentTest#clickAdd_addsOneMinuteToSecondTimer\ncom.android.deskclock.timer.TimerFragmentTest#clickReset_resetsSecondTimer\ncom.android.deskclock.timer.TimerFragmentTest#labelClick_opensLabel\ncom.android.deskclock.timer.TimerFragmentTest#initialStateNoTimers\ncom.android.deskclock.timer.TimerFragmentTest#timeClick_restartsTimer\ncom.android.deskclock.timer.TimerFragmentTest#initialStateTwoTimers\ncom.android.deskclock.timer.TimerFragmentTest#fabClick_restartsSecondTimer\ncom.android.deskclock.timer.TimerFragmentTest#showTimerSetupView_fromIntent\ncom.android.deskclock.timer.TimerFragmentTest#fabClick_startsSecondTimer\ncom.android.deskclock.timer.TimerFragmentTest#fabClick_startsTimer\ncom.android.deskclock.timer.TimerFragmentTest#showTimerSetupView_usesLabel_fromIntent\ncom.android.deskclock.timer.TimerFragmentTest#fabClick_pausesTimer\ncom.android.deskclock.timer.TimerFragmentTest#clickReset_resetsTimer\ncom.android.deskclock.timer.TimerFragmentTest#initialStateOneTimer\ncom.android.deskclock.timer.TimerFragmentTest#timeClick_startsSecondTimer\ncom.android.deskclock.timer.TimerFragmentTest#timeClick_restartsSecondTimer\ncom.android.deskclock.timer.TimerFragmentTest#fabClick_pausesSecondTimer\ncom.android.deskclock.timer.TimerFragmentTest#fabClick_resetsSecondTimer\ncom.android.deskclock.timer.TimerFragmentTest#clickAdd_addsOneMinuteToTimer\ncom.android.deskclock.timer.TimerItemFragmentTest#ensureTimerIsHeldSuccessfully_whenOneTimerIsRunning\ncom.android.deskclock.timer.TimerSetupViewTest#fillDisplayWith9s_TimersExist\ncom.android.deskclock.timer.TimerSetupViewTest#validateDefaultState_NoTimersExist\ncom.android.deskclock.timer.TimerSetupViewTest#type0InDefaultState_NoTimersExist\ncom.android.deskclock.timer.TimerSetupViewTest#fillDisplayThenDeleteAll_TimersExist\ncom.android.deskclock.timer.TimerSetupViewTest#validateDefaultState_TimersExist\ncom.android.deskclock.timer.TimerSetupViewTest#fillDisplayWith9s_NoTimersExist\ncom.android.deskclock.timer.TimerSetupViewTest#fillDisplayThenDeleteAll_NoTimersExist\ncom.android.deskclock.timer.TimerSetupViewTest#type0InDefaultState_TimersExist\ncom.android.deskclock.uidata.TabModelTest#ltrTabLayoutIndex\ncom.android.deskclock.uidata.TabModelTest#rtlTabLayoutIndex\n\nLet me know if there is anything else you might need!",
      "parentUuid": "4fcba191_9606ca5b",
      "revId": "05d6dc757b7dba2a9e824d77c302d8992d2c08ef",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a2df4e1c_65f0151f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1081223
      },
      "writtenOn": "2020-07-27T19:44:50Z",
      "side": 1,
      "message": "Fixed the latter here https://android-review.googlesource.com/c/platform/packages/apps/DeskClock/+/1370168\nThe other 2 aren\u0027t related to my changes, TabModel and UiDataModel aren\u0027t touched in any of my CL",
      "parentUuid": "7877e11a_da3df8d5",
      "revId": "05d6dc757b7dba2a9e824d77c302d8992d2c08ef",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "387809f6_6b10762a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1691576
      },
      "writtenOn": "2020-07-27T20:16:42Z",
      "side": 1,
      "message": "It seems your fix did not resolve the mViewPager issue. The following might be a more specific stack trace:\n\nCaused by: kotlin.UninitializedPropertyAccessException: lateinit property mViewPager has not been initialized\n\tat com.android.deskclock.timer.TimerFragment.updatePageIndicators(TimerFragment.kt:395)\n\tat com.android.deskclock.timer.TimerFragment.onStart(TimerFragment.kt:119)\n\tat com.android.deskclock.timer.TimerFragmentTest.lambda$setUpFragment$2(TimerFragmentTest.java:111)\n\tat com.android.deskclock.timer.TimerFragmentTest.lambda$setUpFragment$2$TimerFragmentTest(Unknown Source:0)\n\tat com.android.deskclock.timer.-$$Lambda$TimerFragmentTest$bbqr-FCA7vojXsaYYr8mIC0f0K0.run(Unknown Source:2)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:462)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:266)\n\tat android.app.Instrumentation$SyncRunnable.run(Instrumentation.java:2214)\n\tat android.os.Handler.handleCallback(Handler.java:934)\n\tat android.os.Handler.dispatchMessage(Handler.java:99)\n\tat android.os.Looper.loop(Looper.java:216)\n\tat android.app.ActivityThread.main(ActivityThread.java:7396)\n\tat java.lang.reflect.Method.invoke(Native Method)\n\tat com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:548)\n\tat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:928)\n\nFrom a quick little bit of digging I did it seems that the changes to TimerFragmentTest cause the mViewPager to not be initialized before fragment.onStart() is called in the setUpFragment() function in that test class.\n\n\n\nRegarding the other two errors I\u0027m not sure what in these changes might have exposed them but it appears that now selectTab() in DeskClockFragment.java and getTabAt() in UiDataModel.java and .kt are only called within the test code and thus must have a @Keep annotation added to them (similar to line 515 of data/DataModel.kt).\n\n\n\nAs well, I missed the following error on my first pass (in TimerItemFragmentTest#ensureTimerIsHeldSuccessfully_whenOneTimerIsRunning):\n\njava.lang.RuntimeException: java.lang.NoSuchMethodError: No virtual method getAdapter()Landroidx/viewpager/widget/PagerAdapter; in class Landroidx/viewpager/widget/ViewPager; or its super classes (declaration of \u0027androidx.viewpager.widget.ViewPager\u0027 appears in /data/app/com.android.deskclock-m3J9XW3uQWmzPFJNHpqoeQ\u003d\u003d/base.apk)\n\tat androidx.test.runner.MonitoringInstrumentation.runOnMainSync(MonitoringInstrumentation.java:450)\n\tat com.android.deskclock.timer.TimerItemFragmentTest.ensureTimerIsHeldSuccessfully_whenOneTimerIsRunning(TimerItemFragmentTest.java:76)\n\tat java.lang.reflect.Method.invoke(Native Method)\n\tat org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)\n\tat org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)\n\tat org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:52)\n\tat org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)\n\tat org.junit.internal.runners.statements.FailOnTimeout$CallableStatement.call(FailOnTimeout.java:148)\n\tat org.junit.internal.runners.statements.FailOnTimeout$CallableStatement.call(FailOnTimeout.java:142)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:266)\n\tat java.lang.Thread.run(Thread.java:922)\nCaused by: java.lang.NoSuchMethodError: No virtual method getAdapter()Landroidx/viewpager/widget/PagerAdapter; in class Landroidx/viewpager/widget/ViewPager; or its super classes (declaration of \u0027androidx.viewpager.widget.ViewPager\u0027 appears in /data/app/com.android.deskclock-m3J9XW3uQWmzPFJNHpqoeQ\u003d\u003d/base.apk)\n\tat com.android.deskclock.timer.TimerItemFragmentTest.lambda$ensureTimerIsHeldSuccessfully_whenOneTimerIsRunning$0(TimerItemFragmentTest.java:65)\n\tat com.android.deskclock.timer.-$$Lambda$TimerItemFragmentTest$V_kmXhsV8OUaXeZ4zoILCGh7utg.run(Unknown Source:2)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:462)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:266)\n\tat android.app.Instrumentation$SyncRunnable.run(Instrumentation.java:2214)\n\tat android.os.Handler.handleCallback(Handler.java:934)\n\tat android.os.Handler.dispatchMessage(Handler.java:99)\n\tat android.os.Looper.loop(Looper.java:216)\n\tat android.app.ActivityThread.main(ActivityThread.java:7396)\n\tat java.lang.reflect.Method.invoke(Native Method)\n\tat com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:548)\n\tat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:928)",
      "parentUuid": "a2df4e1c_65f0151f",
      "revId": "05d6dc757b7dba2a9e824d77c302d8992d2c08ef",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}